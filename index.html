<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--  This file is generated by Nim. -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Favicon -->
<link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAUAAAAF////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAIAAABbAAAAlQAAAKIAAACbAAAAmwAAAKIAAACVAAAAWwAAAAL///8A////AP///wD///8A////AAAAABQAAADAAAAAYwAAAA3///8A////AP///wD///8AAAAADQAAAGMAAADAAAAAFP///wD///8A////AP///wAAAACdAAAAOv///wD///8A////AP///wD///8A////AP///wD///8AAAAAOgAAAJ3///8A////AP///wAAAAAnAAAAcP///wAAAAAoAAAASv///wD///8A////AP///wAAAABKAAAAKP///wAAAABwAAAAJ////wD///8AAAAAgQAAABwAAACIAAAAkAAAAJMAAACtAAAAFQAAABUAAACtAAAAkwAAAJAAAACIAAAAHAAAAIH///8A////AAAAAKQAAACrAAAAaP///wD///8AAAAARQAAANIAAADSAAAARf///wD///8AAAAAaAAAAKsAAACk////AAAAADMAAACcAAAAnQAAABj///8A////AP///wAAAAAYAAAAGP///wD///8A////AAAAABgAAACdAAAAnAAAADMAAAB1AAAAwwAAAP8AAADpAAAAsQAAAE4AAAAb////AP///wAAAAAbAAAATgAAALEAAADpAAAA/wAAAMMAAAB1AAAAtwAAAOkAAAD/AAAA/wAAAP8AAADvAAAA3gAAAN4AAADeAAAA3gAAAO8AAAD/AAAA/wAAAP8AAADpAAAAtwAAAGUAAAA/AAAA3wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAADfAAAAPwAAAGX///8A////AAAAAEgAAADtAAAAvwAAAL0AAADGAAAA7wAAAO8AAADGAAAAvQAAAL8AAADtAAAASP///wD///8A////AP///wD///8AAAAAO////wD///8A////AAAAAIcAAACH////AP///wD///8AAAAAO////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A//8AAP//AAD4HwAA7/cAAN/7AAD//wAAoYUAAJ55AACf+QAAh+EAAAAAAADAAwAA4AcAAP5/AAD//wAA//8AAA=="/>
<link rel="icon" type="image/png" sizes="32x32" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH4QQQEwksSS9ZWwAAAk1JREFUWMPtll2ITVEUx39nn/O7Y5qR8f05wtCUUr6ZIS++8pEnkZInPImneaCQ5METNdOkeFBKUhMPRIkHKfEuUZSUlGlKPN2TrgfncpvmnntnmlEyq1Z7t89/rf9a6+y99oZxGZf/XeIq61EdtgKXgdXA0xrYAvBjOIF1AI9zvjcC74BSpndrJPkBWDScTF8Aa4E3wDlgHbASaANmVqlcCnwHvgDvgVfAJ+AikAAvgfVZwLnSVZHZaOuKoQi3ZOMi4NkYkpe1p4J7A8BpYAD49hfIy/oqG0+hLomiKP2L5L+1ubn5115S+3OAn4EnwBlgMzCjyt6ZAnQCJ4A7wOs88iRJHvw50HoujuPBoCKwHWiosy8MdfZnAdcHk8dxXFJ3VQbQlCTJvRBCGdRbD4M6uc5glpY3eAihpN5S5w12diSEcCCEcKUO4ljdr15T76ur1FDDLIQQ3qv71EdDOe3Kxj3leRXyk+pxdWnFWod6Wt2bY3de3aSuUHcPBVimHs7mK9WrmeOF6lR1o9qnzskh2ar2qm1qizpfXaPeVGdlmGN5pb09qMxz1Xb1kLqgzn1RyH7JUXW52lr5e/Kqi9qpto7V1atuUzfnARrV7jEib1T76gG2qxdGmXyiekkt1GswPTtek0aBfJp6YySGBfWg2tPQ0FAYgf1stUfdmdcjarbYJEniKIq6gY/Aw+zWHAC+p2labGpqiorFYgGYCEzN7oQdQClN07O1/EfDyGgC0ALMBdYAi4FyK+4H3gLPsxfR1zRNi+NP7nH5J+QntnXe5B5mpfQAAAAASUVORK5CYII=">

<!-- Google fonts -->
<link href='https://fonts.googleapis.com/css?family=Lato:400,600,900' rel='stylesheet' type='text/css'/>
<link href='https://fonts.googleapis.com/css?family=Source+Code+Pro:400,500,600' rel='stylesheet' type='text/css'/>

<!-- CSS -->
<title>Norm: A Nim ORM</title>
<link rel="stylesheet" type="text/css" href="nimdoc.out.css">

<script type="text/javascript" src="dochack.js"></script>

<script type="text/javascript">
function main() {
  var pragmaDots = document.getElementsByClassName("pragmadots");
  for (var i = 0; i < pragmaDots.length; i++) {
    pragmaDots[i].onclick = function(event) {
      // Hide tease
      event.target.parentNode.style.display = "none";
      // Show actual
      event.target.parentNode.nextElementSibling.style.display = "inline";
    }
  }

  const toggleSwitch = document.querySelector('.theme-switch input[type="checkbox"]');
  function switchTheme(e) {
      if (e.target.checked) {
          document.documentElement.setAttribute('data-theme', 'dark');
          localStorage.setItem('theme', 'dark');
      } else {
          document.documentElement.setAttribute('data-theme', 'light');
          localStorage.setItem('theme', 'light');
      }
  }

  toggleSwitch.addEventListener('change', switchTheme, false);

  const currentTheme = localStorage.getItem('theme') ? localStorage.getItem('theme') : null;
  if (currentTheme) {
    document.documentElement.setAttribute('data-theme', currentTheme);

    if (currentTheme === 'dark') {
      toggleSwitch.checked = true;
    }
  }
}
</script>

</head>
<body onload="main()">
<div class="document" id="documentId">
  <div class="container">
    <h1 class="title">Norm: A Nim ORM</h1>
    <a class="reference external" href="https://travis-ci.com/moigagoo/norm"><img src="https://travis-ci.com/moigagoo/norm.svg?branch=develop" alt="Build Status"/></a><a class="reference external" href="https://nimble.directory/pkg/norm"><img src="https://img.shields.io/badge/Nimble-2.3.0-yellow?logo=nim" alt="Nimble"/></a><a class="reference external" href="https://github.com/moigagoo/norm"><img src="https://img.shields.io/github/stars/moigagoo/norm" alt="GitHub Stars"/></a><p><strong>Norm</strong> is an object-driven, framework-agnostic ORM for Nim that supports SQLite and PostgreSQL.</p>
<ul class="simple"><li><a class="reference external" href="https://github.com/moigagoo/norm">Repo</a><ul class="simple"><li><a class="reference external" href="https://github.com/moigagoo/norm/issues">Issues</a></li>
<li><a class="reference external" href="https://github.com/moigagoo/norm/pulls">Pull requests</a></li>
</ul>
</li>
<li><a class="reference external" href="https://github.com/moigagoo/shopapp">Sample app</a></li>
<li><a class="reference external" href="https://norm.nim.town/theindex.html">API index</a></li>
<li><a class="reference external" href="https://norm.nim.town/testresults.html">Test results</a></li>
<li><a class="reference external" href="https://github.com/moigagoo/norm/blob/develop/changelog.rst">Changelog</a></li>
</ul>

<h1 id="installation">Installation</h1><p>Install Norm with <a class="reference external" href="https://github.com/nim-lang/nimble">Nimble</a>:</p>
<pre class="listing"><span class="Operator">$</span> <span class="Identifier">nimble</span> <span class="Identifier">install</span> <span class="Operator">-</span><span class="Identifier">y</span> <span class="Identifier">norm</span></pre><p>Add Norm to your .nimble file:</p>
<pre class="listing"><span class="Identifier">requires</span> <span class="StringLit">&quot;norm&quot;</span></pre>
<h1 id="tutorial">Tutorial</h1><p>Before going further, install <a class="reference external" href="https://github.com/inim-repl/INim">inim</a> with nimble:</p>
<pre class="listing"><span class="Operator">$</span> <span class="Identifier">nimble</span> <span class="Identifier">install</span> <span class="Operator">-</span><span class="Identifier">y</span> <span class="Identifier">inim</span></pre><p>Also, make sure you have SQLite installed. On most Linux distributions, it should be preinstalled. To install SQLite in macOS, use <a class="reference external" href="https://brew.sh/">brew</a>. On Windows, use <a class="reference external" href="https://scoop.sh/">scoop</a>.</p>
<p>Then, start a new inim session:</p>
<pre class="listing"><span class="Operator">$</span> <span class="Identifier">inim</span> <span class="Operator">-</span><span class="Identifier">d</span><span class="Punctuation">:</span><span class="Identifier">normDebug</span></pre>
<h2 id="models">Models</h2><p>A model is an abstraction for a unit of your app's business logic. For example, in an online shop, the models might be Product, Customer, and Discount. Sometimes, models are created for entities that are not visible for the end user, but that are necessary from the architecture point of view: User, CartItem, or Permission.</p>
<p>Models can relate to each each with one-to-one, one-to-many, many-to-many relations. For example, a CartItem can have many Discounts, whereas as a single Discount can be applied to many Products.</p>
<p>Models can also inherit from each other. For example, Customer may inherit from User.</p>
<p>In Norm, Models are ref objects inherited from <tt class="docutils literal"><span class="pre">Model</span></tt> root object:</p>
<pre class="listing"><span class="Keyword">import</span> <span class="Identifier">norm</span><span class="Operator">/</span><span class="Identifier">model</span>

<span class="Keyword">type</span>
  <span class="Identifier">User</span> <span class="Operator">=</span> <span class="Keyword">ref</span> <span class="Keyword">object</span> <span class="Keyword">of</span> <span class="Identifier">Model</span>
    <span class="Identifier">email</span><span class="Punctuation">:</span> <span class="Identifier">string</span></pre><p>From a model definition, Norm deduces SQL queries to create tables and insert, select, update, and delete rows. Norm converts Nim objects to rows, their fields to columns, and their types to SQL types and vice versa.</p>
<p>For example, for a model definition like the one above, Norm generates the following table schema:</p>
<pre class="listing"><span class="Identifier">CREATE</span> <span class="Identifier">TABLE</span> <span class="Keyword">IF</span> <span class="Keyword">NOT</span> <span class="Identifier">EXISTS</span> <span class="StringLit">&quot;User&quot;</span><span class="Punctuation">(</span><span class="Identifier">email</span> <span class="Identifier">TEXT</span> <span class="Keyword">NOT</span> <span class="Identifier">NULL</span><span class="Punctuation">,</span> <span class="Identifier">id</span> <span class="Identifier">INTEGER</span> <span class="Keyword">NOT</span> <span class="Identifier">NULL</span> <span class="Identifier">PRIMARY</span> <span class="Identifier">KEY</span><span class="Punctuation">)</span></pre><p>Inherited models are just inherited objects:</p>
<pre class="listing"><span class="Keyword">type</span>
  <span class="Identifier">Customer</span> <span class="Operator">=</span> <span class="Keyword">ref</span> <span class="Keyword">object</span> <span class="Keyword">of</span> <span class="Identifier">User</span>
    <span class="Identifier">name</span><span class="Punctuation">:</span> <span class="Identifier">string</span></pre><p>To create relations between models, define fields subtyped from <tt class="docutils literal"><span class="pre">Model</span></tt>:</p>
<pre class="listing"><span class="Keyword">type</span>
  <span class="Identifier">User</span> <span class="Operator">=</span> <span class="Keyword">ref</span> <span class="Keyword">object</span> <span class="Keyword">of</span> <span class="Identifier">Model</span>
    <span class="Identifier">email</span><span class="Punctuation">:</span> <span class="Identifier">string</span>
  
  <span class="Identifier">Customer</span> <span class="Operator">=</span> <span class="Keyword">ref</span> <span class="Keyword">object</span> <span class="Keyword">of</span> <span class="Identifier">Model</span>
    <span class="Identifier">name</span><span class="Punctuation">:</span> <span class="Identifier">string</span>
    <span class="Identifier">user</span><span class="Punctuation">:</span> <span class="Identifier">User</span></pre><p>To add a <tt class="docutils literal"><span class="pre">UNIQUE</span></tt> constraint to a field, use <tt class="docutils literal"><span class="pre">{.unique.}</span></tt> pragma.</p>
<p><tt class="docutils literal"><span class="pre">UNIQUE</span></tt> constraint ensures all values in a column or a group of columns are distinct from one another.</p>
<pre class="listing"><span class="Keyword">type</span>
  <span class="Identifier">User</span> <span class="Operator">=</span> <span class="Keyword">ref</span> <span class="Keyword">object</span> <span class="Keyword">of</span> <span class="Identifier">Model</span>
    <span class="Identifier">email</span><span class="Punctuation">:</span> <span class="Identifier">string</span>
    <span class="Identifier">name</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">unique</span><span class="Operator">.</span><span class="Punctuation">}</span><span class="Punctuation">:</span> <span class="Identifier">string</span></pre><p>Norm will generate the following table schema:</p>
<pre class="listing"><span class="Identifier">CREATE</span> <span class="Identifier">TABLE</span> <span class="Keyword">IF</span> <span class="Keyword">NOT</span> <span class="Identifier">EXISTS</span> <span class="StringLit">&quot;User&quot;</span><span class="Punctuation">(</span><span class="Identifier">email</span> <span class="Identifier">TEXT</span> <span class="Keyword">NOT</span> <span class="Identifier">NULL</span><span class="Punctuation">,</span> <span class="Identifier">name</span> <span class="Identifier">TEXT</span> <span class="Keyword">NOT</span> <span class="Identifier">NULL</span> <span class="Identifier">UNIQUE</span><span class="Punctuation">,</span> <span class="Identifier">id</span> <span class="Identifier">INTEGER</span> <span class="Keyword">NOT</span> <span class="Identifier">NULL</span> <span class="Identifier">PRIMARY</span> <span class="Identifier">KEY</span><span class="Punctuation">)</span></pre>
<h2 id="create-tables">Create Tables</h2><p>Let's create some tables and examine the queries generated by Norm.</p>
<p>In the inim session, enter this code:</p>
<pre class="listing"><span class="Identifier">nim</span><span class="Operator">&gt;</span> <span class="Keyword">import</span> <span class="Identifier">logging</span><span class="Punctuation">;</span> <span class="Identifier">addHandler</span> <span class="Identifier">newConsoleLogger</span><span class="Punctuation">(</span><span class="Identifier">fmtStr</span> <span class="Operator">=</span> <span class="StringLit">&quot;&quot;</span><span class="Punctuation">)</span>
<span class="Identifier">nim</span><span class="Operator">&gt;</span> <span class="Keyword">import</span> <span class="Identifier">options</span>
<span class="Identifier">nim</span><span class="Operator">&gt;</span> <span class="Keyword">import</span> <span class="Identifier">norm</span><span class="Operator">/</span><span class="Punctuation">[</span><span class="Identifier">model</span><span class="Punctuation">,</span> <span class="Identifier">sqlite</span><span class="Punctuation">]</span></pre><p><tt class="docutils literal"><span class="pre">logging</span></tt> allows us to see the generated queries, <tt class="docutils literal"><span class="pre">options</span></tt> is necessary to support <tt class="docutils literal"><span class="pre">Option</span></tt> fields, <tt class="docutils literal"><span class="pre">norm/model</span></tt> provides <tt class="docutils literal"><span class="pre">Model</span></tt> type to inherit your models from, and <tt class="docutils literal"><span class="pre">norm/sqlite</span></tt> is the SQLite backend, which implements the actual SQL generation and conversion between Nim objects and SQL rows.</p>
<p>Then, define the types:</p>
<pre class="listing"><span class="Identifier">nim</span><span class="Operator">&gt;</span> <span class="Keyword">type</span>
<span class="Operator">....</span>   <span class="Identifier">User</span> <span class="Operator">=</span> <span class="Keyword">ref</span> <span class="Keyword">object</span> <span class="Keyword">of</span> <span class="Identifier">Model</span>
<span class="Operator">....</span>     <span class="Identifier">email</span><span class="Punctuation">:</span> <span class="Identifier">string</span>
<span class="Operator">....</span>   <span class="Identifier">Customer</span> <span class="Operator">=</span> <span class="Keyword">ref</span> <span class="Keyword">object</span> <span class="Keyword">of</span> <span class="Identifier">Model</span>
<span class="Operator">....</span>     <span class="Identifier">name</span><span class="Punctuation">:</span> <span class="Identifier">Option</span><span class="Punctuation">[</span><span class="Identifier">string</span><span class="Punctuation">]</span>
<span class="Operator">....</span>     <span class="Identifier">user</span><span class="Punctuation">:</span> <span class="Identifier">User</span></pre><p>These are your models. It's a good habit to define init procs for your types, so let's do so:</p>
<pre class="listing"><span class="Identifier">nim</span><span class="Operator">&gt;</span> <span class="Keyword">func</span> <span class="Identifier">newUser</span><span class="Punctuation">(</span><span class="Identifier">email</span> <span class="Operator">=</span> <span class="StringLit">&quot;&quot;</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">User</span> <span class="Operator">=</span>
<span class="Operator">....</span>   <span class="Identifier">User</span><span class="Punctuation">(</span><span class="Identifier">email</span><span class="Punctuation">:</span> <span class="Identifier">email</span><span class="Punctuation">)</span>
<span class="Identifier">nim</span><span class="Operator">&gt;</span> <span class="Keyword">func</span> <span class="Identifier">newCustomer</span><span class="Punctuation">(</span><span class="Identifier">name</span> <span class="Operator">=</span> <span class="Identifier">none</span> <span class="Identifier">string</span><span class="Punctuation">,</span> <span class="Identifier">user</span> <span class="Operator">=</span> <span class="Identifier">newUser</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">Customer</span> <span class="Operator">=</span>
<span class="Operator">....</span>   <span class="Identifier">Customer</span><span class="Punctuation">(</span><span class="Identifier">name</span><span class="Punctuation">:</span> <span class="Identifier">name</span><span class="Punctuation">,</span> <span class="Identifier">user</span><span class="Punctuation">:</span> <span class="Identifier">user</span><span class="Punctuation">)</span></pre><p>Now, we are ready to open a connection to the database:</p>
<pre class="listing"><span class="Identifier">nim</span><span class="Operator">&gt;</span> <span class="Keyword">let</span> <span class="Identifier">dbConn</span> <span class="Operator">=</span> <span class="Identifier">open</span><span class="Punctuation">(</span><span class="StringLit">&quot;:memory:&quot;</span><span class="Punctuation">,</span> <span class="StringLit">&quot;&quot;</span><span class="Punctuation">,</span> <span class="StringLit">&quot;&quot;</span><span class="Punctuation">,</span> <span class="StringLit">&quot;&quot;</span><span class="Punctuation">)</span></pre><p>And here is the actual table creation:</p>
<pre class="listing"><span class="Identifier">nim</span><span class="Operator">&gt;</span> <span class="Identifier">dbConn</span><span class="Operator">.</span><span class="Identifier">createTables</span><span class="Punctuation">(</span><span class="Identifier">newCustomer</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">)</span></pre><p>After running this last line, you'll see the generated queries in stdout (formatting added to improve readability):</p>
<pre class="listing"><span class="Identifier">CREATE</span> <span class="Identifier">TABLE</span> <span class="Keyword">IF</span> <span class="Keyword">NOT</span> <span class="Identifier">EXISTS</span> <span class="StringLit">&quot;User&quot;</span><span class="Punctuation">(</span>
    <span class="Identifier">email</span> <span class="Identifier">TEXT</span> <span class="Keyword">NOT</span> <span class="Identifier">NULL</span><span class="Punctuation">,</span>
    <span class="Identifier">id</span> <span class="Identifier">INTEGER</span> <span class="Keyword">NOT</span> <span class="Identifier">NULL</span> <span class="Identifier">PRIMARY</span> <span class="Identifier">KEY</span>
<span class="Punctuation">)</span>

<span class="Identifier">CREATE</span> <span class="Identifier">TABLE</span> <span class="Keyword">IF</span> <span class="Keyword">NOT</span> <span class="Identifier">EXISTS</span> <span class="StringLit">&quot;Customer&quot;</span><span class="Punctuation">(</span>
    <span class="Identifier">name</span> <span class="Identifier">TEXT</span><span class="Punctuation">,</span>
    <span class="Identifier">user</span> <span class="Identifier">INTEGER</span> <span class="Keyword">NOT</span> <span class="Identifier">NULL</span><span class="Punctuation">,</span>
    <span class="Identifier">id</span> <span class="Identifier">INTEGER</span> <span class="Keyword">NOT</span> <span class="Identifier">NULL</span> <span class="Identifier">PRIMARY</span> <span class="Identifier">KEY</span><span class="Punctuation">,</span>
    <span class="Identifier">FOREIGN</span> <span class="Identifier">KEY</span><span class="Punctuation">(</span><span class="Identifier">user</span><span class="Punctuation">)</span> <span class="Identifier">REFERENCES</span> <span class="StringLit">&quot;User&quot;</span><span class="Punctuation">(</span><span class="Identifier">id</span><span class="Punctuation">)</span>
<span class="Punctuation">)</span></pre><p><tt class="docutils literal"><span class="pre">createTables</span></tt> proc takes a model instance and generates a table schema for it. For each of the instance's fields, a column is generated. If a field is itself a <tt class="docutils literal"><span class="pre">Model</span></tt>, a foreign key is added. <tt class="docutils literal"><span class="pre">Option</span></tt> fields are nullable, non-<tt class="docutils literal"><span class="pre">Option</span></tt> ones are <tt class="docutils literal"><span class="pre">NOT NULL</span></tt>.</p>
<p>Note that a single <tt class="docutils literal"><span class="pre">createTables</span></tt> call generated two table schemas. That's because model <tt class="docutils literal"><span class="pre">Customer</span></tt> refers to <tt class="docutils literal"><span class="pre">User</span></tt>, and therefore its table can't be created without the table for <tt class="docutils literal"><span class="pre">User</span></tt> existing beforehand. Norm makes sure all dependency tables are created before creating the one that <tt class="docutils literal"><span class="pre">createTables</span></tt> was actually called with. That's actually why the proc is called <tt class="docutils literal"><span class="pre">createTables</span></tt> and not <tt class="docutils literal"><span class="pre">createTable</span></tt>.</p>
<blockquote><p>Make sure to instantiate models with <tt class="docutils literal"><span class="pre">Model</span></tt> fields so that these fields are not <tt class="docutils literal"><span class="pre">nil</span></tt>. Otherwise, Norm won't be able to create a table schema for them.</p></blockquote>
<p>To keep the code more explicit, feel free to call both <tt class="docutils literal"><span class="pre">dbConn.createTables(newUser())</span></tt> and <tt class="docutils literal"><span class="pre">dbConn.createTables(newCustomer())</span></tt>. The worst thing to happen is the same query being called twice, but since they both have a <tt class="docutils literal"><span class="pre">IF NOT EXISTS</span></tt> constraint, the table will be created only once.</p>
<blockquote><p><p>Note that <tt class="docutils literal"><span class="pre">id</span></tt> column is created despite not being present in <tt class="docutils literal"><span class="pre">User</span></tt> definition. That's because it's a special read-only field maintained automatically by Norm. It represents row id in the database.</p>
<p><strong>Do not define id field or manually update its value.</strong></p>
</p></blockquote>

<h2 id="insert-rows">Insert Rows</h2><p>To insert rows, use <tt class="docutils literal"><span class="pre">insert</span></tt> procs. There is a variant that takes a single model instance or a sequence of them.</p>
<p>Instances passed to <tt class="docutils literal"><span class="pre">insert</span></tt> must be mutable for Norm to be able to update their <tt class="docutils literal"><span class="pre">id</span></tt> fields.</p>
<p>In your inim session, run:</p>
<pre class="listing"><span class="Identifier">nim</span><span class="Operator">&gt;</span> <span class="Keyword">var</span>
<span class="Operator">....</span>   <span class="Identifier">userFoo</span> <span class="Operator">=</span> <span class="Identifier">newUser</span><span class="Punctuation">(</span><span class="StringLit">&quot;foo@foo.foo&quot;</span><span class="Punctuation">)</span>
<span class="Operator">....</span>   <span class="Identifier">userBar</span> <span class="Operator">=</span> <span class="Identifier">newUser</span><span class="Punctuation">(</span><span class="StringLit">&quot;bar@bar.bar&quot;</span><span class="Punctuation">)</span>
<span class="Operator">....</span>   <span class="Identifier">alice</span> <span class="Operator">=</span> <span class="Identifier">newCustomer</span><span class="Punctuation">(</span><span class="Identifier">some</span> <span class="StringLit">&quot;Alice&quot;</span><span class="Punctuation">,</span> <span class="Identifier">userFoo</span><span class="Punctuation">)</span>
<span class="Operator">....</span>   <span class="Identifier">bob</span> <span class="Operator">=</span> <span class="Identifier">newCustomer</span><span class="Punctuation">(</span><span class="Identifier">some</span> <span class="StringLit">&quot;Bob&quot;</span><span class="Punctuation">,</span> <span class="Identifier">userFoo</span><span class="Punctuation">)</span>
<span class="Operator">....</span>   <span class="Identifier">sam</span> <span class="Operator">=</span> <span class="Identifier">newCustomer</span><span class="Punctuation">(</span><span class="Identifier">some</span> <span class="StringLit">&quot;Sam&quot;</span><span class="Punctuation">,</span> <span class="Identifier">userBar</span><span class="Punctuation">)</span>
<span class="Operator">....</span>   <span class="Identifier">aliceAndBob</span> <span class="Operator">=</span> <span class="Punctuation">[</span><span class="Identifier">alice</span><span class="Punctuation">,</span> <span class="Identifier">bob</span><span class="Punctuation">]</span></pre><p>Those are the objects we'll insert as rows in the database:</p>
<pre class="listing"><span class="Identifier">nim</span><span class="Operator">&gt;</span> <span class="Keyword">import</span> <span class="Identifier">std</span><span class="Operator">/</span><span class="Identifier">with</span>
<span class="Identifier">nim</span><span class="Operator">&gt;</span> <span class="Identifier">with</span> <span class="Identifier">dbConn</span><span class="Punctuation">:</span>
<span class="Operator">....</span>   <span class="Identifier">insert</span> <span class="Identifier">aliceAndBob</span>
<span class="Operator">....</span>   <span class="Identifier">insert</span> <span class="Identifier">userBar</span>
<span class="Operator">....</span>   <span class="Identifier">insert</span> <span class="Identifier">sam</span></pre><p>Let's examine the queries:</p>
<pre class="listing"><span class="Identifier">INSERT</span> <span class="Identifier">INTO</span> <span class="StringLit">&quot;User&quot;</span> <span class="Punctuation">(</span><span class="Identifier">email</span><span class="Punctuation">)</span> <span class="Identifier">VALUES</span><span class="Punctuation">(</span><span class="Operator">?</span><span class="Punctuation">)</span> <span class="Operator">&lt;-</span> <span class="Operator">@</span><span class="Punctuation">[</span><span class="CharLit">'foo@foo.foo'</span><span class="Punctuation">]</span>
<span class="Identifier">INSERT</span> <span class="Identifier">INTO</span> <span class="StringLit">&quot;Customer&quot;</span> <span class="Punctuation">(</span><span class="Identifier">name</span><span class="Punctuation">,</span> <span class="Identifier">user</span><span class="Punctuation">)</span> <span class="Identifier">VALUES</span><span class="Punctuation">(</span><span class="Operator">?</span><span class="Punctuation">,</span> <span class="Operator">?</span><span class="Punctuation">)</span> <span class="Operator">&lt;-</span> <span class="Operator">@</span><span class="Punctuation">[</span><span class="CharLit">'Alice'</span><span class="Punctuation">,</span> <span class="DecNumber">1</span><span class="Punctuation">]</span>
<span class="Identifier">INSERT</span> <span class="Identifier">INTO</span> <span class="StringLit">&quot;Customer&quot;</span> <span class="Punctuation">(</span><span class="Identifier">name</span><span class="Punctuation">,</span> <span class="Identifier">user</span><span class="Punctuation">)</span> <span class="Identifier">VALUES</span><span class="Punctuation">(</span><span class="Operator">?</span><span class="Punctuation">,</span> <span class="Operator">?</span><span class="Punctuation">)</span> <span class="Operator">&lt;-</span> <span class="Operator">@</span><span class="Punctuation">[</span><span class="CharLit">'Bob'</span><span class="Punctuation">,</span> <span class="DecNumber">1</span><span class="Punctuation">]</span>
<span class="Identifier">INSERT</span> <span class="Identifier">INTO</span> <span class="StringLit">&quot;User&quot;</span> <span class="Punctuation">(</span><span class="Identifier">email</span><span class="Punctuation">)</span> <span class="Identifier">VALUES</span><span class="Punctuation">(</span><span class="Operator">?</span><span class="Punctuation">)</span> <span class="Operator">&lt;-</span> <span class="Operator">@</span><span class="Punctuation">[</span><span class="CharLit">'bar@bar.bar'</span><span class="Punctuation">]</span>
<span class="Identifier">INSERT</span> <span class="Identifier">INTO</span> <span class="StringLit">&quot;Customer&quot;</span> <span class="Punctuation">(</span><span class="Identifier">name</span><span class="Punctuation">,</span> <span class="Identifier">user</span><span class="Punctuation">)</span> <span class="Identifier">VALUES</span><span class="Punctuation">(</span><span class="Operator">?</span><span class="Punctuation">,</span> <span class="Operator">?</span><span class="Punctuation">)</span> <span class="Operator">&lt;-</span> <span class="Operator">@</span><span class="Punctuation">[</span><span class="CharLit">'Sam'</span><span class="Punctuation">,</span> <span class="DecNumber">2</span><span class="Punctuation">]</span></pre><p>When Norm attempts to insert <tt class="docutils literal"><span class="pre">alice</span></tt>, it detects that <tt class="docutils literal"><span class="pre">userFoo</span></tt> that it referenced in it has not been inserted yet, so there's no <tt class="docutils literal"><span class="pre">id</span></tt> to store as foreign key. So, Norm inserts <tt class="docutils literal"><span class="pre">userFoo</span></tt> automatically and then uses its new <tt class="docutils literal"><span class="pre">id</span></tt> (in this case, 1) as the foreign key value.</p>
<p>With <tt class="docutils literal"><span class="pre">bob</span></tt>, there's no need to do that since <tt class="docutils literal"><span class="pre">userFoo</span></tt> is already in the database.</p>
<p>You can insert dependency models explicitly to make the code more verbose, as seen with <tt class="docutils literal"><span class="pre">userBar</span></tt> and <tt class="docutils literal"><span class="pre">sam</span></tt>.</p>

<h2 id="select-rows">Select Rows</h2><p>To select a rows with Norm, you instantiate a model that serves as a container for the selected data and call <tt class="docutils literal"><span class="pre">select</span></tt>.</p>
<p>One curious thing about <tt class="docutils literal"><span class="pre">select</span></tt> is that its result depends not only on the condition you pass but also on the container. If the container has <tt class="docutils literal"><span class="pre">Model</span></tt> fields that are not <tt class="docutils literal"><span class="pre">None</span></tt>, Norm will select the related rows in a single <tt class="docutils literal"><span class="pre">JOIN</span></tt> query giving you a fully populated model object. However, if the container has a <tt class="docutils literal"><span class="pre">none Model</span></tt> field, it is just ignored.</p>
<p>In other words, Norm will automatically handle the &quot;n+1&quot; problem.</p>
<p>Let's see how that works:</p>
<pre class="listing"><span class="Identifier">nim</span><span class="Operator">&gt;</span> <span class="Keyword">var</span> <span class="Identifier">customerBar</span> <span class="Operator">=</span> <span class="Identifier">newCustomer</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
<span class="Identifier">nim</span><span class="Operator">&gt;</span> <span class="Identifier">dbConn</span><span class="Operator">.</span><span class="Identifier">select</span><span class="Punctuation">(</span><span class="Identifier">customerBar</span><span class="Punctuation">,</span> <span class="StringLit">&quot;User.email = ?&quot;</span><span class="Punctuation">,</span> <span class="StringLit">&quot;bar@bar.bar&quot;</span><span class="Punctuation">)</span></pre><p>This is the SQL query generated by this <tt class="docutils literal"><span class="pre">select</span></tt> call:</p>
<pre class="listing"><span class="Identifier">SELECT</span> <span class="StringLit">&quot;Customer&quot;</span><span class="Operator">.</span><span class="Identifier">name</span><span class="Punctuation">,</span> <span class="StringLit">&quot;User&quot;</span><span class="Operator">.</span><span class="Identifier">email</span><span class="Punctuation">,</span> <span class="StringLit">&quot;User&quot;</span><span class="Operator">.</span><span class="Identifier">id</span><span class="Punctuation">,</span> <span class="StringLit">&quot;Customer&quot;</span><span class="Operator">.</span><span class="Identifier">id</span>
<span class="Keyword">FROM</span> <span class="StringLit">&quot;Customer&quot;</span> <span class="Identifier">JOIN</span> <span class="StringLit">&quot;User&quot;</span> <span class="Identifier">ON</span> <span class="StringLit">&quot;Customer&quot;</span><span class="Operator">.</span><span class="Identifier">user</span> <span class="Operator">=</span> <span class="StringLit">&quot;User&quot;</span><span class="Operator">.</span><span class="Identifier">id</span>
<span class="Identifier">WHERE</span> <span class="Identifier">User</span><span class="Operator">.</span><span class="Identifier">email</span> <span class="Operator">=</span> <span class="Operator">?</span> <span class="Operator">&lt;-</span> <span class="Punctuation">[</span><span class="CharLit">'bar@bar.bar'</span><span class="Punctuation">]</span></pre><p>Let's examine how Norm populated <tt class="docutils literal"><span class="pre">customerBar</span></tt>:</p>
<pre class="listing"><span class="Identifier">nim</span><span class="Operator">&gt;</span> <span class="Identifier">echo</span> <span class="Identifier">customerBar</span><span class="Punctuation">[</span><span class="Punctuation">]</span>
<span class="Punctuation">(</span><span class="Identifier">name</span><span class="Punctuation">:</span> <span class="Identifier">Some</span><span class="Punctuation">(</span><span class="StringLit">&quot;Sam&quot;</span><span class="Punctuation">)</span><span class="Punctuation">,</span> <span class="Identifier">user</span><span class="Punctuation">:</span> <span class="Operator">...</span><span class="Punctuation">,</span> <span class="Identifier">id</span><span class="Punctuation">:</span> <span class="DecNumber">3</span><span class="Punctuation">)</span>
<span class="Identifier">nim</span><span class="Operator">&gt;</span> <span class="Identifier">echo</span> <span class="Identifier">customerBar</span><span class="Operator">.</span><span class="Identifier">user</span><span class="Punctuation">[</span><span class="Punctuation">]</span>
<span class="Punctuation">(</span><span class="Identifier">email</span><span class="Punctuation">:</span> <span class="StringLit">&quot;bar@bar.bar&quot;</span><span class="Punctuation">,</span> <span class="Identifier">id</span><span class="Punctuation">:</span> <span class="DecNumber">2</span><span class="Punctuation">)</span></pre><p>If you pass a sequence to <tt class="docutils literal"><span class="pre">select</span></tt>, you'll get many rows:</p>
<pre class="listing"><span class="Identifier">nim</span><span class="Operator">&gt;</span> <span class="Keyword">var</span> <span class="Identifier">customersFoo</span> <span class="Operator">=</span> <span class="Operator">@</span><span class="Punctuation">[</span><span class="Identifier">newCustomer</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">]</span>
<span class="Identifier">nim</span><span class="Operator">&gt;</span> <span class="Identifier">dbConn</span><span class="Operator">.</span><span class="Identifier">select</span><span class="Punctuation">(</span><span class="Identifier">customersFoo</span><span class="Punctuation">,</span> <span class="StringLit">&quot;User.email = ?&quot;</span><span class="Punctuation">,</span> <span class="StringLit">&quot;foo@foo.foo&quot;</span><span class="Punctuation">)</span></pre><p>The generated query is similar to the previous one, but the result is populated objects, not one:</p>
<pre class="listing"><span class="Identifier">nim</span><span class="Operator">&gt;</span> <span class="Keyword">for</span> <span class="Identifier">customer</span> <span class="Keyword">in</span> <span class="Identifier">customersFoo</span><span class="Punctuation">:</span>
<span class="Operator">....</span>   <span class="Identifier">echo</span> <span class="Identifier">customer</span><span class="Punctuation">[</span><span class="Punctuation">]</span>
<span class="Operator">....</span>   <span class="Identifier">echo</span> <span class="Identifier">customer</span><span class="Operator">.</span><span class="Identifier">user</span><span class="Punctuation">[</span><span class="Punctuation">]</span>
<span class="Operator">....</span>
<span class="Punctuation">(</span><span class="Identifier">name</span><span class="Punctuation">:</span> <span class="Identifier">Some</span><span class="Punctuation">(</span><span class="StringLit">&quot;Alice&quot;</span><span class="Punctuation">)</span><span class="Punctuation">,</span> <span class="Identifier">user</span><span class="Punctuation">:</span> <span class="Operator">...</span><span class="Punctuation">,</span> <span class="Identifier">id</span><span class="Punctuation">:</span> <span class="DecNumber">1</span><span class="Punctuation">)</span>
<span class="Punctuation">(</span><span class="Identifier">email</span><span class="Punctuation">:</span> <span class="StringLit">&quot;foo@foo.foo&quot;</span><span class="Punctuation">,</span> <span class="Identifier">id</span><span class="Punctuation">:</span> <span class="DecNumber">1</span><span class="Punctuation">)</span>
<span class="Punctuation">(</span><span class="Identifier">name</span><span class="Punctuation">:</span> <span class="Identifier">Some</span><span class="Punctuation">(</span><span class="StringLit">&quot;Bob&quot;</span><span class="Punctuation">)</span><span class="Punctuation">,</span> <span class="Identifier">user</span><span class="Punctuation">:</span> <span class="Operator">...</span><span class="Punctuation">,</span> <span class="Identifier">id</span><span class="Punctuation">:</span> <span class="DecNumber">2</span><span class="Punctuation">)</span>
<span class="Punctuation">(</span><span class="Identifier">email</span><span class="Punctuation">:</span> <span class="StringLit">&quot;foo@foo.foo&quot;</span><span class="Punctuation">,</span> <span class="Identifier">id</span><span class="Punctuation">:</span> <span class="DecNumber">1</span><span class="Punctuation">)</span></pre>
<h2 id="count-rows">Count Rows</h2><p>Selecting rows is expensive if many rows are fetched. Knowing the number of rows you have before doing the actual select is useful.</p>
<p>To count the rows without fetching them, use <tt class="docutils literal"><span class="pre">count</span></tt>:</p>
<pre class="listing"><span class="Identifier">nim</span><span class="Operator">&gt;</span> <span class="Identifier">dbConn</span><span class="Operator">.</span><span class="Identifier">count</span><span class="Punctuation">(</span><span class="Identifier">Customer</span><span class="Punctuation">)</span>
<span class="DecNumber">3</span></pre><p>To count only unique records, use <tt class="docutils literal"><span class="pre">dist = true</span></tt> in conjunction with the column name you want to check for uniqueness:</p>
<pre class="listing"><span class="Identifier">nim</span><span class="Operator">&gt;</span> <span class="Identifier">dbConn</span><span class="Operator">.</span><span class="Identifier">count</span><span class="Punctuation">(</span><span class="Identifier">Customer</span><span class="Punctuation">,</span> <span class="StringLit">&quot;user&quot;</span><span class="Punctuation">,</span> <span class="Identifier">dist</span> <span class="Operator">=</span> <span class="Identifier">true</span><span class="Punctuation">)</span>
<span class="DecNumber">2</span></pre><p>You can also count rows matching condition:</p>
<pre class="listing"><span class="Identifier">nim</span><span class="Operator">&gt;</span> <span class="Identifier">dbConn</span><span class="Operator">.</span><span class="Identifier">count</span><span class="Punctuation">(</span><span class="Identifier">Customer</span><span class="Punctuation">,</span> <span class="StringLit">&quot;*&quot;</span><span class="Punctuation">,</span> <span class="Identifier">dist</span> <span class="Operator">=</span> <span class="Identifier">false</span><span class="Punctuation">,</span> <span class="StringLit">&quot;name LIKE ?&quot;</span><span class="Punctuation">,</span> <span class="StringLit">&quot;alice&quot;</span><span class="Punctuation">)</span>
<span class="DecNumber">1</span></pre>
<h2 id="update-rows">Update Rows</h2><p>To update a row, you just update the object and call <tt class="docutils literal"><span class="pre">update</span></tt> on it:</p>
<pre class="listing"><span class="Identifier">nim</span><span class="Operator">&gt;</span> <span class="Identifier">customerBar</span><span class="Operator">.</span><span class="Identifier">name</span> <span class="Operator">=</span> <span class="Identifier">some</span> <span class="StringLit">&quot;Saaam&quot;</span>
<span class="Identifier">nim</span><span class="Operator">&gt;</span> <span class="Identifier">dbConn</span><span class="Operator">.</span><span class="Identifier">update</span><span class="Punctuation">(</span><span class="Identifier">customerBar</span><span class="Punctuation">)</span></pre><p>Since customer references a user, to update a customer, we also need to update its user. Norm handles that automatically by generating two queries:</p>
<pre class="listing"><span class="Identifier">UPDATE</span> <span class="StringLit">&quot;User&quot;</span> <span class="Identifier">SET</span> <span class="Identifier">email</span> <span class="Operator">=</span> <span class="Operator">?</span> <span class="Identifier">WHERE</span> <span class="Identifier">id</span> <span class="Operator">=</span> <span class="DecNumber">2</span> <span class="Operator">&lt;-</span> <span class="Operator">@</span><span class="Punctuation">[</span><span class="CharLit">'bar@bar.bar'</span><span class="Punctuation">]</span>
<span class="Identifier">UPDATE</span> <span class="StringLit">&quot;Customer&quot;</span> <span class="Identifier">SET</span> <span class="Identifier">name</span> <span class="Operator">=</span> <span class="Operator">?</span><span class="Punctuation">,</span> <span class="Identifier">user</span> <span class="Operator">=</span> <span class="Operator">?</span> <span class="Identifier">WHERE</span> <span class="Identifier">id</span> <span class="Operator">=</span> <span class="DecNumber">3</span> <span class="Operator">&lt;-</span> <span class="Operator">@</span><span class="Punctuation">[</span><span class="CharLit">'Saaam'</span><span class="Punctuation">,</span> <span class="DecNumber">2</span><span class="Punctuation">]</span></pre><p>Updating rows in bulk is also possible:</p>
<pre class="listing"><span class="Identifier">nim</span><span class="Operator">&gt;</span> <span class="Keyword">for</span> <span class="Identifier">customer</span> <span class="Keyword">in</span> <span class="Identifier">customersFoo</span><span class="Punctuation">:</span>
<span class="Operator">....</span>   <span class="Identifier">customer</span><span class="Operator">.</span><span class="Identifier">name</span> <span class="Operator">=</span> <span class="Identifier">some</span> <span class="Punctuation">(</span><span class="Identifier">get</span><span class="Punctuation">(</span><span class="Identifier">customer</span><span class="Operator">.</span><span class="Identifier">name</span><span class="Punctuation">)</span> <span class="Operator">&amp;</span> <span class="Identifier">get</span><span class="Punctuation">(</span><span class="Identifier">customer</span><span class="Operator">.</span><span class="Identifier">name</span><span class="Punctuation">)</span><span class="Punctuation">)</span>
<span class="Operator">....</span>
<span class="Identifier">nim</span><span class="Operator">&gt;</span> <span class="Identifier">dbConn</span><span class="Operator">.</span><span class="Identifier">update</span><span class="Punctuation">(</span><span class="Identifier">customersFoo</span><span class="Punctuation">)</span></pre><p>For each object in <tt class="docutils literal"><span class="pre">customersFoo</span></tt>, a pair of queries are generated:</p>
<pre class="listing"><span class="Identifier">UPDATE</span> <span class="StringLit">&quot;User&quot;</span> <span class="Identifier">SET</span> <span class="Identifier">email</span> <span class="Operator">=</span> <span class="Operator">?</span> <span class="Identifier">WHERE</span> <span class="Identifier">id</span> <span class="Operator">=</span> <span class="DecNumber">1</span> <span class="Operator">&lt;-</span> <span class="Operator">@</span><span class="Punctuation">[</span><span class="CharLit">'foo@foo.foo'</span><span class="Punctuation">]</span>
<span class="Identifier">UPDATE</span> <span class="StringLit">&quot;Customer&quot;</span> <span class="Identifier">SET</span> <span class="Identifier">name</span> <span class="Operator">=</span> <span class="Operator">?</span><span class="Punctuation">,</span> <span class="Identifier">user</span> <span class="Operator">=</span> <span class="Operator">?</span> <span class="Identifier">WHERE</span> <span class="Identifier">id</span> <span class="Operator">=</span> <span class="DecNumber">1</span> <span class="Operator">&lt;-</span> <span class="Operator">@</span><span class="Punctuation">[</span><span class="CharLit">'AliceAlice'</span><span class="Punctuation">,</span> <span class="DecNumber">1</span><span class="Punctuation">]</span>
<span class="Identifier">UPDATE</span> <span class="StringLit">&quot;User&quot;</span> <span class="Identifier">SET</span> <span class="Identifier">email</span> <span class="Operator">=</span> <span class="Operator">?</span> <span class="Identifier">WHERE</span> <span class="Identifier">id</span> <span class="Operator">=</span> <span class="DecNumber">1</span> <span class="Operator">&lt;-</span> <span class="Operator">@</span><span class="Punctuation">[</span><span class="CharLit">'foo@foo.foo'</span><span class="Punctuation">]</span>
<span class="Identifier">UPDATE</span> <span class="StringLit">&quot;Customer&quot;</span> <span class="Identifier">SET</span> <span class="Identifier">name</span> <span class="Operator">=</span> <span class="Operator">?</span><span class="Punctuation">,</span> <span class="Identifier">user</span> <span class="Operator">=</span> <span class="Operator">?</span> <span class="Identifier">WHERE</span> <span class="Identifier">id</span> <span class="Operator">=</span> <span class="DecNumber">2</span> <span class="Operator">&lt;-</span> <span class="Operator">@</span><span class="Punctuation">[</span><span class="CharLit">'BobBob'</span><span class="Punctuation">,</span> <span class="DecNumber">1</span><span class="Punctuation">]</span></pre>
<h2 id="delete-rows">Delete Rows</h2><p>To delete a row, call <tt class="docutils literal"><span class="pre">delete</span></tt> on an object:</p>
<pre class="listing"><span class="Identifier">nim</span><span class="Operator">&gt;</span> <span class="Identifier">dbConn</span><span class="Operator">.</span><span class="Identifier">delete</span><span class="Punctuation">(</span><span class="Identifier">sam</span><span class="Punctuation">)</span></pre><p>That gives you, quite expectedly:</p>
<pre class="listing"><span class="Identifier">DELETE</span> <span class="Keyword">FROM</span> <span class="StringLit">&quot;Customer&quot;</span> <span class="Identifier">WHERE</span> <span class="Identifier">id</span> <span class="Operator">=</span> <span class="DecNumber">3</span></pre><p>After deletion, the object becomes <tt class="docutils literal"><span class="pre">nil</span></tt>:</p>
<pre class="listing"><span class="Identifier">nim</span><span class="Operator">&gt;</span> <span class="Identifier">echo</span> <span class="Identifier">sam</span><span class="Operator">.</span><span class="Identifier">isNil</span>
<span class="Identifier">true</span></pre>
<h2 id="fancy-syntax">Fancy Syntax</h2><p>To avoid creating intermediate containers here and there, use Nim's <tt class="docutils literal"><span class="pre">dup</span></tt> macro to create mutable objects on the fly.</p>
<p>For example, here's how you insert ten rows without having to create ten stale objects</p>
<pre class="listing"><span class="Identifier">nim</span><span class="Operator">&gt;</span> <span class="Keyword">for</span> <span class="Identifier">i</span> <span class="Keyword">in</span> <span class="FloatNumber">1.</span><span class="Operator">.</span><span class="DecNumber">10</span><span class="Punctuation">:</span>
<span class="Operator">....</span>   <span class="Keyword">discard</span> <span class="Identifier">newUser</span><span class="Punctuation">(</span><span class="Operator">$</span><span class="Identifier">i</span> <span class="Operator">&amp;</span> <span class="StringLit">&quot;@example.com&quot;</span><span class="Punctuation">)</span><span class="Operator">.</span><span class="Identifier">dup</span><span class="Punctuation">:</span>
<span class="Operator">....</span>     <span class="Identifier">dbConn</span><span class="Operator">.</span><span class="Identifier">insert</span></pre><p><tt class="docutils literal"><span class="pre">dup</span></tt> lets you call multiple procs, which gives a pleasant interface for row filter and bulk manipulation:</p>
<pre class="listing"><span class="Identifier">nim</span><span class="Operator">&gt;</span> <span class="Keyword">discard</span> <span class="Operator">@</span><span class="Punctuation">[</span><span class="Identifier">newUser</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">]</span><span class="Operator">.</span><span class="Identifier">dup</span><span class="Punctuation">:</span>
<span class="Operator">....</span>   <span class="Identifier">dbConn</span><span class="Operator">.</span><span class="Identifier">select</span><span class="Punctuation">(</span><span class="StringLit">&quot;email LIKE ?&quot;</span><span class="Punctuation">,</span> <span class="StringLit">&quot;_@example.com&quot;</span><span class="Punctuation">)</span>
<span class="Operator">....</span>   <span class="Identifier">dbConn</span><span class="Operator">.</span><span class="Identifier">delete</span></pre>
<h2 id="transactions">Transactions</h2><p>To run queries in a transaction, wrap the code in a <tt class="docutils literal"><span class="pre">transaction</span></tt> block:</p>
<pre class="listing"><span class="Identifier">nim</span><span class="Operator">&gt;</span> <span class="Identifier">dbConn</span><span class="Operator">.</span><span class="Identifier">transaction</span><span class="Punctuation">:</span>
<span class="Operator">....</span>   <span class="Keyword">for</span> <span class="Identifier">i</span> <span class="Keyword">in</span> <span class="FloatNumber">11.</span><span class="Operator">.</span><span class="DecNumber">13</span><span class="Punctuation">:</span>
<span class="Operator">....</span>     <span class="Keyword">discard</span> <span class="Identifier">newUser</span><span class="Punctuation">(</span><span class="Operator">$</span><span class="Identifier">i</span> <span class="Operator">&amp;</span> <span class="StringLit">&quot;@example.com&quot;</span><span class="Punctuation">)</span><span class="Operator">.</span><span class="Identifier">dup</span><span class="Punctuation">:</span>
<span class="Operator">....</span>       <span class="Identifier">dbConn</span><span class="Operator">.</span><span class="Identifier">insert</span></pre><p>This produces the following SQL:</p>
<pre class="listing"><span class="Identifier">BEGIN</span>
<span class="Identifier">INSERT</span> <span class="Identifier">INTO</span> <span class="StringLit">&quot;User&quot;</span> <span class="Punctuation">(</span><span class="Identifier">email</span><span class="Punctuation">)</span> <span class="Identifier">VALUES</span><span class="Punctuation">(</span><span class="Operator">?</span><span class="Punctuation">)</span> <span class="Operator">&lt;-</span> <span class="Operator">@</span><span class="Punctuation">[</span><span class="CharLit">'11@example.com'</span><span class="Punctuation">]</span>
<span class="Identifier">INSERT</span> <span class="Identifier">INTO</span> <span class="StringLit">&quot;User&quot;</span> <span class="Punctuation">(</span><span class="Identifier">email</span><span class="Punctuation">)</span> <span class="Identifier">VALUES</span><span class="Punctuation">(</span><span class="Operator">?</span><span class="Punctuation">)</span> <span class="Operator">&lt;-</span> <span class="Operator">@</span><span class="Punctuation">[</span><span class="CharLit">'12@example.com'</span><span class="Punctuation">]</span>
<span class="Identifier">INSERT</span> <span class="Identifier">INTO</span> <span class="StringLit">&quot;User&quot;</span> <span class="Punctuation">(</span><span class="Identifier">email</span><span class="Punctuation">)</span> <span class="Identifier">VALUES</span><span class="Punctuation">(</span><span class="Operator">?</span><span class="Punctuation">)</span> <span class="Operator">&lt;-</span> <span class="Operator">@</span><span class="Punctuation">[</span><span class="CharLit">'13@example.com'</span><span class="Punctuation">]</span>
<span class="Identifier">COMMIT</span></pre><p>If something goes wrong inside a transaction block, i.e. an exception is raised, the transaction is rollbacked.</p>
<p>To rollback a transaction manually, call <tt class="docutils literal"><span class="pre">rollback</span></tt> proc:</p>
<pre class="listing"><span class="Identifier">nim</span><span class="Operator">&gt;</span> <span class="Identifier">dbConn</span><span class="Operator">.</span><span class="Identifier">transaction</span><span class="Punctuation">:</span>
<span class="Operator">....</span>   <span class="Keyword">for</span> <span class="Identifier">i</span> <span class="Keyword">in</span> <span class="FloatNumber">14.</span><span class="Operator">.</span><span class="DecNumber">16</span><span class="Punctuation">:</span>
<span class="Operator">....</span>     <span class="Keyword">discard</span> <span class="Identifier">newUser</span><span class="Punctuation">(</span><span class="Operator">$</span><span class="Identifier">i</span> <span class="Operator">&amp;</span> <span class="StringLit">&quot;@example.com&quot;</span><span class="Punctuation">)</span><span class="Operator">.</span><span class="Identifier">dup</span><span class="Punctuation">:</span>
<span class="Operator">....</span>       <span class="Identifier">dbConn</span><span class="Operator">.</span><span class="Identifier">insert</span>
<span class="Operator">....</span>
<span class="Operator">....</span>     <span class="Keyword">if</span> <span class="Identifier">i</span> <span class="Operator">==</span> <span class="DecNumber">15</span><span class="Punctuation">:</span>
<span class="Operator">....</span>       <span class="Identifier">rollback</span><span class="Punctuation">(</span><span class="Punctuation">)</span></pre>
<h2 id="read-configuration-from-environment-variables">Read Configuration from Environment Variables</h2><p>In a real-life project, you want to keep your DB configuration separate from the code. Common pattern is to put it in environment variables, probably in a <tt class="docutils literal"><span class="pre">.env</span></tt> file that's processed during the app startup.</p>
<p>Norm's <tt class="docutils literal"><span class="pre">getDb</span></tt> proc lets you create a DB connection using <tt class="docutils literal"><span class="pre">DB_HOST</span></tt>, <tt class="docutils literal"><span class="pre">DB_USER</span></tt>, <tt class="docutils literal"><span class="pre">DB_PASS</span></tt>, and <tt class="docutils literal"><span class="pre">DB_NAME</span></tt> environment variables:</p>
<pre class="listing"><span class="Identifier">nim</span><span class="Operator">&gt;</span> <span class="Keyword">import</span> <span class="Identifier">os</span>
<span class="Identifier">nim</span><span class="Operator">&gt;</span> <span class="Identifier">putEnv</span><span class="Punctuation">(</span><span class="StringLit">&quot;DB_HOST&quot;</span><span class="Punctuation">,</span> <span class="StringLit">&quot;:memory:&quot;</span><span class="Punctuation">)</span>
<span class="Identifier">nim</span><span class="Operator">&gt;</span> <span class="Keyword">let</span> <span class="Identifier">db</span> <span class="Operator">=</span> <span class="Identifier">getDb</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
<span class="Identifier">nim</span><span class="Operator">&gt;</span> <span class="Keyword">var</span> <span class="Identifier">customerBar</span> <span class="Operator">=</span> <span class="Identifier">newCustomer</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
<span class="Identifier">nim</span><span class="Operator">&gt;</span> <span class="Identifier">db</span><span class="Operator">.</span><span class="Identifier">select</span><span class="Punctuation">(</span><span class="Identifier">customerBar</span><span class="Punctuation">,</span> <span class="StringLit">&quot;User.email = ?&quot;</span><span class="Punctuation">,</span> <span class="StringLit">&quot;bar@bar.bar&quot;</span><span class="Punctuation">)</span></pre><p><tt class="docutils literal"><span class="pre">withDb</span></tt> template is even handier as it lets you run code without explicitly creating or closing a DB connection:</p>
<pre class="listing"><span class="Identifier">nim</span><span class="Operator">&gt;</span> <span class="Identifier">withDb</span><span class="Punctuation">:</span>
<span class="Operator">....</span>   <span class="Keyword">var</span> <span class="Identifier">customerBar</span> <span class="Operator">=</span> <span class="Identifier">newCustomer</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
<span class="Operator">....</span>   <span class="Identifier">db</span><span class="Operator">.</span><span class="Identifier">select</span><span class="Punctuation">(</span><span class="Identifier">customerBar</span><span class="Punctuation">,</span> <span class="StringLit">&quot;User.email = ?&quot;</span><span class="Punctuation">,</span> <span class="StringLit">&quot;bar@bar.bar&quot;</span><span class="Punctuation">)</span></pre>
<h2 id="manual-foreign-key-handling">Manual Foreign Key Handling</h2><p>Norm handles foreign keys automatically if you have a field of type <tt class="docutils literal"><span class="pre">Model</span></tt>. However, it has a downside: to fill up an object from the DB, Norm always fetches all related objects along with the original one, potentially generating a heavy JOIN query.</p>
<p>To work around that limitation, you can declare and handle foreign keys manually, with <tt class="docutils literal"><span class="pre">fk</span></tt> pragma:</p>
<pre class="listing"><span class="Keyword">type</span>
  <span class="Identifier">Product</span> <span class="Operator">=</span> <span class="Keyword">ref</span> <span class="Keyword">object</span> <span class="Keyword">of</span> <span class="Identifier">Model</span>
    <span class="Identifier">name</span><span class="Punctuation">:</span> <span class="Identifier">string</span>
    <span class="Identifier">price</span><span class="Punctuation">:</span> <span class="Identifier">float</span>
  
  <span class="Identifier">Consumer</span> <span class="Operator">=</span> <span class="Keyword">ref</span> <span class="Keyword">object</span> <span class="Keyword">of</span> <span class="Identifier">Model</span>
    <span class="Identifier">email</span><span class="Punctuation">:</span> <span class="Identifier">string</span>
    <span class="Identifier">productId</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">fk</span><span class="Punctuation">:</span> <span class="Identifier">Product</span><span class="Operator">.</span><span class="Punctuation">}</span><span class="Punctuation">:</span> <span class="Identifier">int</span>

<span class="Keyword">proc</span> <span class="Identifier">newProduct</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">Product</span> <span class="Operator">=</span>
  <span class="Identifier">Product</span><span class="Punctuation">(</span><span class="Identifier">name</span><span class="Punctuation">:</span> <span class="StringLit">&quot;&quot;</span><span class="Punctuation">,</span> <span class="Identifier">price</span><span class="Punctuation">:</span> <span class="FloatNumber">0.0</span><span class="Punctuation">)</span>

<span class="Keyword">proc</span> <span class="Identifier">newConsumer</span><span class="Punctuation">(</span><span class="Identifier">email</span><span class="Punctuation">:</span> <span class="Identifier">string</span> <span class="Operator">=</span> <span class="StringLit">&quot;&quot;</span><span class="Punctuation">,</span> <span class="Identifier">productId</span><span class="Punctuation">:</span> <span class="Identifier">int</span> <span class="Operator">=</span> <span class="DecNumber">0</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">Consumer</span> <span class="Operator">=</span>
  <span class="Identifier">Consumer</span><span class="Punctuation">(</span><span class="Identifier">email</span><span class="Punctuation">:</span> <span class="Identifier">email</span><span class="Punctuation">,</span> <span class="Identifier">productId</span><span class="Punctuation">:</span> <span class="Identifier">productId</span><span class="Punctuation">)</span></pre><p>When using <tt class="docutils literal"><span class="pre">fk</span></tt> pragma, foreign key must be handled manually, so <tt class="docutils literal"><span class="pre">createTables</span></tt> needs to be called for both <tt class="docutils literal"><span class="pre">Model</span></tt>s:</p>
<pre class="listing"><span class="Keyword">let</span> <span class="Identifier">db</span> <span class="Operator">=</span> <span class="Identifier">open</span><span class="Punctuation">(</span><span class="StringLit">&quot;&quot;</span><span class="Punctuation">,</span> <span class="StringLit">&quot;&quot;</span><span class="Punctuation">,</span> <span class="StringLit">&quot;&quot;</span><span class="Punctuation">,</span> <span class="StringLit">&quot;&quot;</span><span class="Punctuation">)</span>

<span class="Identifier">db</span><span class="Operator">.</span><span class="Identifier">createTables</span><span class="Punctuation">(</span><span class="Identifier">newProduct</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">)</span>
<span class="Identifier">db</span><span class="Operator">.</span><span class="Identifier">createTables</span><span class="Punctuation">(</span><span class="Identifier">newConsumer</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">)</span></pre><p>Norm will generate the following table schema:</p>
<pre class="listing"><span class="Identifier">CREATE</span> <span class="Identifier">TABLE</span> <span class="Keyword">IF</span> <span class="Keyword">NOT</span> <span class="Identifier">EXISTS</span> <span class="StringLit">&quot;Product&quot;</span><span class="Punctuation">(</span><span class="Identifier">name</span> <span class="Identifier">TEXT</span> <span class="Keyword">NOT</span> <span class="Identifier">NULL</span><span class="Punctuation">,</span> <span class="Identifier">price</span> <span class="Identifier">FLOAT</span> <span class="Keyword">NOT</span> <span class="Identifier">NULL</span><span class="Punctuation">,</span> <span class="Identifier">id</span> <span class="Identifier">INTEGER</span> <span class="Keyword">NOT</span> <span class="Identifier">NULL</span> <span class="Identifier">PRIMARY</span> <span class="Identifier">KEY</span><span class="Punctuation">)</span>
<span class="Identifier">CREATE</span> <span class="Identifier">TABLE</span> <span class="Keyword">IF</span> <span class="Keyword">NOT</span> <span class="Identifier">EXISTS</span> <span class="StringLit">&quot;Consumer&quot;</span><span class="Punctuation">(</span><span class="Identifier">email</span> <span class="Identifier">TEXT</span> <span class="Keyword">NOT</span> <span class="Identifier">NULL</span><span class="Punctuation">,</span> <span class="Identifier">productId</span> <span class="Identifier">INTEGER</span> <span class="Keyword">NOT</span> <span class="Identifier">NULL</span><span class="Punctuation">,</span> <span class="Identifier">id</span> <span class="Identifier">INTEGER</span> <span class="Keyword">NOT</span> <span class="Identifier">NULL</span> <span class="Identifier">PRIMARY</span> <span class="Identifier">KEY</span><span class="Punctuation">,</span> <span class="Identifier">FOREIGN</span> <span class="Identifier">KEY</span> <span class="Punctuation">(</span><span class="Identifier">productId</span><span class="Punctuation">)</span> <span class="Identifier">REFERENCES</span> <span class="StringLit">&quot;Product&quot;</span><span class="Punctuation">(</span><span class="Identifier">id</span><span class="Punctuation">)</span><span class="Punctuation">)</span></pre><p><tt class="docutils literal"><span class="pre">insert</span></tt> statements can now be done using only <tt class="docutils literal"><span class="pre">id</span></tt>. This allows for more flexibility at the cost of more manual queries:</p>
<pre class="listing"><span class="Keyword">var</span> <span class="Identifier">cheese</span> <span class="Operator">=</span> <span class="Identifier">Product</span><span class="Punctuation">(</span><span class="Identifier">name</span><span class="Punctuation">:</span> <span class="StringLit">&quot;Cheese&quot;</span><span class="Punctuation">,</span> <span class="Identifier">price</span><span class="Punctuation">:</span> <span class="FloatNumber">13.30</span><span class="Punctuation">)</span>
<span class="Identifier">db</span><span class="Operator">.</span><span class="Identifier">insert</span><span class="Punctuation">(</span><span class="Identifier">cheese</span><span class="Punctuation">)</span>

<span class="Keyword">var</span> <span class="Identifier">bob</span> <span class="Operator">=</span> <span class="Identifier">newConsumer</span><span class="Punctuation">(</span><span class="StringLit">&quot;bob@mail.org&quot;</span><span class="Punctuation">,</span> <span class="Identifier">cheese</span><span class="Operator">.</span><span class="Identifier">id</span><span class="Punctuation">)</span>
<span class="Identifier">db</span><span class="Operator">.</span><span class="Identifier">insert</span><span class="Punctuation">(</span><span class="Identifier">bob</span><span class="Punctuation">)</span></pre><p>On <tt class="docutils literal"><span class="pre">insert</span></tt>, Norm will generate the following queries :</p>
<pre class="listing"><span class="Identifier">DEBUG</span> <span class="Identifier">INSERT</span> <span class="Identifier">INTO</span> <span class="StringLit">&quot;Product&quot;</span> <span class="Punctuation">(</span><span class="Identifier">name</span><span class="Punctuation">,</span> <span class="Identifier">price</span><span class="Punctuation">)</span> <span class="Identifier">VALUES</span><span class="Punctuation">(</span><span class="Operator">?</span><span class="Punctuation">,</span> <span class="Operator">?</span><span class="Punctuation">)</span> <span class="Operator">&lt;-</span> <span class="Operator">@</span><span class="Punctuation">[</span><span class="CharLit">'Cheese'</span><span class="Punctuation">,</span> <span class="FloatNumber">13.3</span><span class="Punctuation">]</span>
<span class="Identifier">DEBUG</span> <span class="Identifier">INSERT</span> <span class="Identifier">INTO</span> <span class="StringLit">&quot;Consumer&quot;</span> <span class="Punctuation">(</span><span class="Identifier">email</span><span class="Punctuation">,</span> <span class="Identifier">productId</span><span class="Punctuation">)</span> <span class="Identifier">VALUES</span><span class="Punctuation">(</span><span class="Operator">?</span><span class="Punctuation">,</span> <span class="Operator">?</span><span class="Punctuation">)</span> <span class="Operator">&lt;-</span> <span class="Operator">@</span><span class="Punctuation">[</span><span class="CharLit">'bob@mail.org'</span><span class="Punctuation">,</span> <span class="DecNumber">1</span><span class="Punctuation">]</span></pre><p>If an invalid ID is passed, Norm will raise a <tt class="docutils literal"><span class="pre">DbError</span></tt> exception:</p>
<pre class="listing"><span class="Keyword">let</span> <span class="Identifier">badProductId</span> <span class="Operator">=</span> <span class="DecNumber">133</span>
<span class="Keyword">var</span> <span class="Identifier">bob</span> <span class="Operator">=</span> <span class="Identifier">newConsumer</span><span class="Punctuation">(</span><span class="StringLit">&quot;Paul&quot;</span><span class="Punctuation">,</span> <span class="Identifier">badProductId</span><span class="Punctuation">)</span>
<span class="Identifier">db</span><span class="Operator">.</span><span class="Identifier">insert</span><span class="Punctuation">(</span><span class="Identifier">bob</span><span class="Punctuation">)</span></pre><p>Output:</p>
<pre class="listing"><span class="Identifier">Error</span><span class="Punctuation">:</span> <span class="Identifier">unhandled</span> <span class="Identifier">exception</span><span class="Punctuation">:</span> <span class="Identifier">FOREIGN</span> <span class="Identifier">KEY</span> <span class="Identifier">constraint</span> <span class="Identifier">failed</span> <span class="Punctuation">[</span><span class="Identifier">DbError</span><span class="Punctuation">]</span></pre><p><tt class="docutils literal"><span class="pre">select</span></tt> queries will only return the <tt class="docutils literal"><span class="pre">id</span></tt> referenced and not the associated fields:</p>
<pre class="listing"><span class="Keyword">var</span> <span class="Identifier">consumer</span> <span class="Operator">=</span> <span class="Identifier">newConsumer</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
<span class="Identifier">db</span><span class="Operator">.</span><span class="Identifier">select</span><span class="Punctuation">(</span><span class="Identifier">consumer</span><span class="Punctuation">,</span> <span class="StringLit">&quot;name = $1&quot;</span><span class="Punctuation">,</span> <span class="StringLit">&quot;Bob&quot;</span><span class="Punctuation">)</span>
<span class="Identifier">doAssert</span><span class="Punctuation">(</span><span class="Identifier">consumer</span><span class="Operator">.</span><span class="Identifier">name</span> <span class="Operator">==</span> <span class="StringLit">&quot;Bob&quot;</span><span class="Punctuation">)</span>

<span class="Keyword">var</span> <span class="Identifier">product</span> <span class="Operator">=</span> <span class="Identifier">newProduct</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
<span class="Identifier">db</span><span class="Operator">.</span><span class="Identifier">select</span><span class="Punctuation">(</span><span class="Identifier">product</span><span class="Punctuation">,</span> <span class="StringLit">&quot;id = $1&quot;</span><span class="Punctuation">,</span> <span class="Identifier">consumer</span><span class="Operator">.</span><span class="Identifier">productId</span><span class="Punctuation">)</span>
<span class="Identifier">doAssert</span><span class="Punctuation">(</span><span class="Identifier">product</span><span class="Operator">.</span><span class="Identifier">name</span> <span class="Operator">==</span> <span class="StringLit">&quot;Cheese&quot;</span><span class="Punctuation">)</span>
<span class="Identifier">doAssert</span><span class="Punctuation">(</span><span class="Identifier">product</span><span class="Operator">.</span><span class="Identifier">price</span> <span class="Operator">==</span> <span class="FloatNumber">13.30</span><span class="Punctuation">)</span></pre><p>Norm will generate the following query:</p>
<pre class="listing"><span class="Identifier">DEBUG</span> <span class="Identifier">SELECT</span> <span class="StringLit">&quot;Consumer&quot;</span><span class="Operator">.</span><span class="Identifier">name</span><span class="Punctuation">,</span> <span class="StringLit">&quot;Consumer&quot;</span><span class="Operator">.</span><span class="Identifier">productId</span><span class="Punctuation">,</span> <span class="StringLit">&quot;Consumer&quot;</span><span class="Operator">.</span><span class="Identifier">id</span> <span class="Keyword">FROM</span> <span class="StringLit">&quot;Consumer&quot;</span>  <span class="Identifier">WHERE</span> <span class="Identifier">name</span> <span class="Operator">=</span> <span class="Operator">$</span><span class="DecNumber">1</span> <span class="Operator">&lt;-</span> <span class="Punctuation">[</span><span class="CharLit">'Bob'</span><span class="Punctuation">]</span>
<span class="Identifier">DEBUG</span> <span class="Identifier">SELECT</span> <span class="StringLit">&quot;Product&quot;</span><span class="Operator">.</span><span class="Identifier">name</span><span class="Punctuation">,</span> <span class="StringLit">&quot;Product&quot;</span><span class="Operator">.</span><span class="Identifier">price</span><span class="Punctuation">,</span> <span class="StringLit">&quot;Product&quot;</span><span class="Operator">.</span><span class="Identifier">id</span> <span class="Keyword">FROM</span> <span class="StringLit">&quot;Product&quot;</span>  <span class="Identifier">WHERE</span> <span class="Identifier">id</span> <span class="Operator">=</span> <span class="Operator">$</span><span class="DecNumber">1</span> <span class="Operator">&lt;-</span> <span class="Punctuation">[</span><span class="DecNumber">1</span><span class="Punctuation">]</span></pre>
<h2 id="debugging-sql-queries">Debugging SQL Queries</h2><p>To enable the logging of SQL queries, define <tt class="docutils literal"><span class="pre">normDebug</span></tt> either by compiling with <tt class="docutils literal"><span class="pre">-d:normDebug</span></tt>, or by adding <tt class="docutils literal"><span class="pre">switch(&quot;define&quot;, &quot;normDebug&quot;)</span></tt> to config.nims</p>
<p>Once <tt class="docutils literal"><span class="pre">normDebug</span></tt> is defined, simply add a logger on debug level (see <a class="reference external" href="https://nim-lang.org/docs/logging.html">https://nim-lang.org/docs/logging.html</a> for more info):</p>
<pre class="listing"><span class="Keyword">import</span> <span class="Identifier">logging</span>
<span class="Keyword">var</span> <span class="Identifier">consoleLog</span> <span class="Operator">=</span> <span class="Identifier">newConsoleLogger</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
<span class="Identifier">addHandler</span><span class="Punctuation">(</span><span class="Identifier">consoleLog</span><span class="Punctuation">)</span></pre>
<h1 id="contributing">Contributing</h1><p>Any contributions are welcome: pull requests, code reviews, documentation improvements, bug reports, and feature requests.</p>
<ul class="simple"><li>See the <a class="reference external" href="http://github.com/moigagoo/norm/issues">issues on GitHub</a>.</li>
<li><p>Run the tests before and after you change the code.</p>
<p>The recommended way to run the tests is with Docker Compose:</p>
<pre class="listing"><span class="Operator">$</span> <span class="Identifier">docker</span><span class="Operator">-</span><span class="Identifier">compose</span> <span class="Identifier">run</span> <span class="Operator">--</span><span class="Identifier">rm</span> <span class="Identifier">tests</span>                     <span class="Comment"># run all test suites</span>
<span class="Operator">$</span> <span class="Identifier">docker</span><span class="Operator">-</span><span class="Identifier">compose</span> <span class="Identifier">run</span> <span class="Operator">--</span><span class="Identifier">rm</span> <span class="Identifier">test</span> <span class="Identifier">tests</span><span class="Operator">/</span><span class="Identifier">tmodel</span><span class="Operator">.</span><span class="Identifier">nim</span>     <span class="Comment"># run a single test suite</span></pre></li>
</ul>
<ul class="simple"><li>Use camelCase instead of snake_case.</li>
<li>New procs must have a documentation comment. If you modify an existing proc, update the comment.</li>
<li>Apart from the code that implements a feature or fixes a bug, PRs are required to ship necessary tests and a changelog updates.</li>
</ul>

<h2 id="-contributors-"> Contributors </h2><p>Norm would not be where it is today without the efforts of these fine folks: <a class="reference external" href="https://github.com/moigagoo/norm/graphs/contributors">https://github.com/moigagoo/norm/graphs/contributors</a>. </p>



    <div class="row">
      <div class="twelve-columns footer">
        <span class="nim-sprite"></span>
        <br/>
        <small style="color: var(--hint);">Made with Nim. Generated: 2021-04-08 11:01:08 UTC</small>
      </div>
    </div>
  </div>
</div>

</body>
</html>
