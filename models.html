<!DOCTYPE HTML>
<html lang="en-us" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using nimibook -->
        <meta charset="UTF-8">
        <title>Models 101 - Norm</title>

        <!-- Custom HTML head -->

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Object-driven ORM for SQLite and Postgres">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2280%22>üê≥</text></svg>">
        <link rel="stylesheet" href="./assets/css/variables.css">
        <link rel="stylesheet" href="./assets/css/general.css">
        <link rel="stylesheet" href="./assets/css/chrome.css">

        <!-- Fonts -->
        <link rel="stylesheet" href="./assets/FontAwesome/css/font-awesome.min.css">

        <!-- Highlight.js Stylesheets - I could use nimib native highlight but let's keep it for styling... -->
        <link rel="stylesheet" href="./assets/css/highlight.css">
        <link rel="stylesheet" href="./assets/css/tomorrow-night.css">
        <link rel="stylesheet" href="./assets/css/ayu-highlight.css">

        <!-- Custom theme stylesheets - why the "../"? -->


        
        
        <!-- plausible analytics (new in nimibook) -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = ".//assets";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                                <ol class="chapter">
                <li class="chapter-item expanded ">
                  <a href="./index.html" tabindex="0">
                    <strong aria-hidden="true">1.</strong> Welcome to Norm!
                  </a></li>
                <li class="chapter-item expanded ">
                  <a href="./models.html" class="active" tabindex="0">
                    <strong aria-hidden="true">2.</strong> Models 101
                  </a></li>
                <li class="chapter-item expanded ">
                  <a href="./tutorial.html" tabindex="0">
                    <strong aria-hidden="true">3.</strong> Tutorial
                  </a></li>
                  <li>
                  <ol class="section">
                <li class="chapter-item expanded ">
                  <a href="./tutorial/tables.html" tabindex="0">
                    <strong aria-hidden="true">3.1.</strong> Tables
                  </a></li>
                <li class="chapter-item expanded ">
                  <a href="./tutorial/rows.html" tabindex="0">
                    <strong aria-hidden="true">3.2.</strong> Rows
                  </a></li>
                <li class="chapter-item expanded ">
                  <a href="./tutorial/rowCaveats.html" tabindex="0">
                    <strong aria-hidden="true">3.3.</strong> Row Caveats
                  </a></li>
                  </ol>
                  </li>
                <li class="chapter-item expanded ">
                  <a href="./fancy.html" tabindex="0">
                    <strong aria-hidden="true">4.</strong> Fancy Syntax
                  </a></li>
                <li class="chapter-item expanded ">
                  <a href="./transactions.html" tabindex="0">
                    <strong aria-hidden="true">5.</strong> Transactions
                  </a></li>
                <li class="chapter-item expanded ">
                  <a href="./config.html" tabindex="0">
                    <strong aria-hidden="true">6.</strong> Configuration from Environment
                  </a></li>
                <li class="chapter-item expanded ">
                  <a href="./fk.html" tabindex="0">
                    <strong aria-hidden="true">7.</strong> Manual Foreign Key Handling
                  </a></li>
                <li class="chapter-item expanded ">
                  <a href="./debug.html" tabindex="0">
                    <strong aria-hidden="true">8.</strong> Debugging SQL
                  </a></li>
                <li class="chapter-item expanded ">
                  <a href="./changelog.html" tabindex="0">
                    <strong aria-hidden="true">9.</strong> Changelog
                  </a></li>
                </ol>
<!-- I could use also an unescaped context value -->
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                    </div>

                    <h1 class="menu-title">Norm</h1>

                    <div class="right-buttons">
                        <a href="https://github.com/moigagoo/norm" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>


                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1>Models 101</h1>
<p>A model is an abstraction for a unit of your app's business logic. For example, in an online shop, the models might be Product, Customer, and Discount. Sometimes, models are created for entities that are not visible for the end user, but that are necessary from the architecture point of view: User, CartItem, or Permission.</p>
<p>Models can relate to each each with one-to-one, one-to-many, many-to-many relations. For example, a CartItem can have many Discounts, whereas as a single Discount can be applied to many Products.</p>
<p>Models can also inherit from each other. For example, Customer may inherit from User.</p>
<p>In Norm, Models are ref objects inherited from <code>Model</code> root object:</p>
                        <pre><code class="nim hljs"><span class="hljs-keyword">import</span> norm/model

<span class="hljs-keyword">type</span>
  <span class="hljs-type">BaseUser</span>* = <span class="hljs-keyword">ref</span> <span class="hljs-keyword">object</span> <span class="hljs-keyword">of</span> <span class="hljs-type">Model</span>
    email: <span class="hljs-built_in">string</span></code></pre>
                        <p>From a model definition, Norm deduces SQL queries to create tables and insert, select, update, and delete rows. Norm converts Nim objects to rows, their fields to columns, and their types to SQL types and vice versa.</p>
<p>For example, for a model definition like the one above, Norm generates the following table schema:</p>
<pre><code>CREATE TABLE IF NOT EXISTS &quot;User&quot;(email TEXT NOT NULL, id INTEGER NOT NULL PRIMARY KEY)
</code></pre>
<p>Inherited models are just inherited objects:</p>
                        <pre><code class="nim hljs"><span class="hljs-keyword">type</span>
  <span class="hljs-type">NamedUser</span>* = <span class="hljs-keyword">ref</span> <span class="hljs-keyword">object</span> <span class="hljs-keyword">of</span> <span class="hljs-type">BaseUser</span>
    name: <span class="hljs-built_in">string</span></code></pre>
                        <p>To create relations between models, define fields subtyped from <code>Model</code>:</p>
                        <pre><code class="nim hljs"><span class="hljs-keyword">type</span>
  <span class="hljs-type">User</span>* = <span class="hljs-keyword">ref</span> <span class="hljs-keyword">object</span> <span class="hljs-keyword">of</span> <span class="hljs-type">Model</span>
    email: <span class="hljs-built_in">string</span>

  <span class="hljs-type">Customer</span>* = <span class="hljs-keyword">ref</span> <span class="hljs-keyword">object</span> <span class="hljs-keyword">of</span> <span class="hljs-type">Model</span>
    name: <span class="hljs-built_in">string</span>
    user: <span class="hljs-type">User</span></code></pre>
                        <p>To add a <code>UNIQUE</code> constraint to a field, use <code>{.unique.}</code> pragma.</p>
<p><code>UNIQUE</code> constraint ensures all values in a column or a group of columns are distinct from one another.</p>
                        <pre><code class="nim hljs"><span class="hljs-keyword">import</span> norm/pragmas

<span class="hljs-keyword">type</span>
  <span class="hljs-type">Client</span>* = <span class="hljs-keyword">ref</span> <span class="hljs-keyword">object</span> <span class="hljs-keyword">of</span> <span class="hljs-type">Model</span>
    email: <span class="hljs-built_in">string</span>
    name {.unique.}: <span class="hljs-built_in">string</span></code></pre>
                        <p>Norm will generate the following table schema:</p>
<pre><code>CREATE TABLE IF NOT EXISTS &quot;User&quot;(email TEXT NOT NULL, name TEXT NOT NULL UNIQUE, id INTEGER NOT NULL PRIMARY KEY)
</code></pre>
<p>To define unique combination or columns, add <code>{.uniqueGroup.}</code> pragma to each field in the group.</p>
<h2>Custom Table Name</h2>
<p>By default, a table is named after the model type, enclosed in double quotes, e.g. <code>User</code> model's table is called <code>&quot;User&quot;</code>.</p>
<p>To override this behavior and set a custom name for the generated table, use <code>tableName</code> pragma:</p>
                        <pre><code class="nim hljs"><span class="hljs-keyword">type</span>
  <span class="hljs-type">Thing</span>* {.tableName: <span class="hljs-string">&quot;ThingTable&quot;</span>.} = <span class="hljs-keyword">ref</span> <span class="hljs-keyword">object</span> <span class="hljs-keyword">of</span> <span class="hljs-type">Model</span>
    attr: <span class="hljs-built_in">string</span></code></pre>
                        <p>This will result in this schema:</p>
<pre><code>CREATE TABLE IF NOT EXISTS &quot;ThingTable&quot;(attr TEXT NOT NULL, id INTEGER NOT NULL PRIMARY KEY)
</code></pre>
<h2>Read-only Models</h2>
<p>To slim down DB queries when you don't need to fetch the full model, use read-only models.</p>
<p>A read-only model is a model that defines a subset of fields of another model. Another important property of read-only model is that you can't use it to insert, update, or delete data; just select.</p>
<p>To define a read-only model, annotate your <code>Model</code> subtype with <code>readOnly</code> or <code>ro</code> pragma and point it to an existing table with <code>tableName</code>:</p>
                        <pre><code class="nim hljs"><span class="hljs-keyword">type</span>
  <span class="hljs-type">ClientName</span>* {.readOnly, tableName: <span class="hljs-string">&quot;Client&quot;</span>.} = <span class="hljs-keyword">ref</span> <span class="hljs-keyword">object</span> <span class="hljs-keyword">of</span> <span class="hljs-type">Model</span>
    name: <span class="hljs-built_in">string</span></code></pre>
                        <p>Now you can query data from the DB into <code>ClientName</code> instances just like you do with any other model.</p>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="./index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="./tutorial.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="./index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="./tutorial.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>







        <script src="./assets/js/clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="./assets/js/highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="./assets/js/book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
